---
title: Building Web Applications
description: Considerations and patterns for building Web3 applications on Prividium™ chains.
downloadable: true
---

Build Web3 applications on Prividium™ chains using the `prividium` SDK.

> [!NOTE] Architecture Overview
>
> For a high-level understanding of Prividium's architecture and components, see
> [Prividium™ Architecture](../00.prividium_architecture.md).

## Table of Contents

1. [Application Configuration](#application-configuration)
2. [Prividium™ SDK Initialization](#prividium-sdk-initialization)
3. [Authentication and OAuth Scopes](#authentication-and-oauth-scopes)
4. [RPC URL Architecture](#rpc-url-architecture)
5. [Browser Extension Wallets](#browser-extension-wallets)
6. [Reading from Contracts](#reading-from-contracts)
7. [Sending Transactions](#sending-transactions)
8. [Error Handling](#error-handling)
9. [Summary](#summary)
10. [Next Steps](#next-steps)

## Application Configuration

Register a client in the Prividium™ Admin Panel before building your web application. This client authenticates users
and authorizes access to your application.

### 1. Register OAuth Client

1. **Access Admin Panel**: Open the Prividium™ Admin Panel.
2. **Create Application**: Register a new client. Save your `CLIENT_ID`.
3. **Configure CORS**: Add your application's origin URL to the allowed CORS origins.
4. **Set Redirect URL**: Set the callback URL (e.g., `https://your-app.com/callback`) for post-auth redirection.

### 2. Configure Application URLs

Configure these URLs in your application:

- **RPC URL**: The base proxy RPC endpoint (e.g., `https://proxy.prividium.dev/rpc`)
- **Prividium™ API URL**: The Prividium™ API base URL (e.g., `https://api.prividium.dev`)
- **Auth Base URL**: The authentication service URL (e.g., `https://user-panel.prividium.dev`)
- **Callback URL**: Your application's callback route (matches the redirect URL in the OAuth client)

## Prividium™ SDK Initialization

Use the `prividium` SDK to initialize and connect to your chain:

Requirements:

- **Chain ID**: The chain ID of your Prividium™ network
- **Chain Metadata**: Display name, native currency details, and block explorer URL (if applicable)

Initialize the Prividium™ SDK using `createPrividiumChain()`:

```typescript
import { createPrividiumChain } from 'prividium';
import { defineChain } from 'viem';

// Define your Prividium chain
const prividiumChain = defineChain({
  id: parseInt(process.env.CHAIN_ID || '12345'),
  name: process.env.CHAIN_NAME || 'Prividium',
  nativeCurrency: {
    name: process.env.NATIVE_CURRENCY_NAME || 'ETH',
    symbol: process.env.NATIVE_CURRENCY_SYMBOL || 'ETH',
    decimals: parseInt(process.env.NATIVE_CURRENCY_DECIMALS || '18')
  },
  rpcUrls: {
    default: {
      http: [process.env.RPC_URL || 'https://api.prividium.dev/rpc']
    }
  },
  blockExplorers: process.env.BLOCK_EXPLORER_URL
    ? {
        default: {
          name: 'Explorer',
          url: process.env.BLOCK_EXPLORER_URL
        }
      }
    : undefined
});

// Initialize Prividium SDK
const prividium = createPrividiumChain({
  clientId: process.env.CLIENT_ID || process.env.PRIVIDIUM_CLIENT_ID,
  chain: prividiumChain,
  authBaseUrl: process.env.AUTH_BASE_URL || 'https://user-panel.prividium.dev',
  prividiumApiUrl: process.env.PRIVIDIUM_API_BASE_URL || 'https://api.prividium.dev',
  redirectUrl: process.env.AUTH_CALLBACK_URL || 'https://your-app.com/callback',
  onAuthExpiry: () => {
    console.log('Authentication expired - please reconnect');
  }
});

// Initialize client for chain interaction
const client = createPublicClient({
  chain: prividiumChain,
  transport: prividium.transport
});
```

> [!NOTE] NOTE
>
> Adjust environment variable access for your framework (e.g., `import.meta.env.*` for Vite, `process.env.*` for
> Node.js).

## Authentication and OAuth Scopes

### Overview

Prividium™ uses OAuth 2.0 with popup-based authentication. The authentication flow determines your application's
permitted operations.

### OAuth Scopes

Prividium™ supports two OAuth scopes that control application capabilities:

- **`wallet:required`** - Ensures the user has at least one wallet address.
- **`network:required`** - Generates a custom RPC endpoint via the user panel. Ensures correct wallet chain
  configuration.

### Authentication Flow

1. User clicks authenticate button
2. SDK opens popup with Prividium™ User Panel
3. User authenticates. The `network:required` scope prompts for network addition with the custom RPC
4. Popup redirects to `/callback` page
5. SDK handles callback and stores JWT token
6. Popup closes automatically
7. Main window receives authentication success

> [!IMPORTANT] IMPORTANT
>
> Your application's callback page must call `handleAuthCallback()`

```typescript
// src/pages/Callback.tsx
import { handleAuthCallback } from 'prividium';

useEffect(() => {
  handleAuthCallback((errorMessage) => {
    if (errorMessage) {
      console.error('Authentication error:', errorMessage);
      // Handle error
    } else {
      // Authentication successful, popup will close
    }
  });
}, []);
```

### Token Storage

The Prividium™ SDK automatically manages token storage:

- **Storage key**: `prividium_token_${chainId}` in `localStorage`
- **OAuth state**: `prividium_auth_state_${chainId}` in `localStorage`
- **Read-only flag**: `prividium_read_only_access` in `localStorage` (custom)

> [!NOTE] NOTE
>
> Use the SDK's `isAuthorized()` and `getAuthHeaders()` methods. Never manage tokens manually.

## RPC URL Architecture

Prividium™ provides **separate RPC endpoints** which handle authentication differently:

- **Base URL**: `https://YOUR-PRIVIDUM-ENDPOINT/rpc`: This is the base URL for all RPC operations and requires
  authentication headers (e.g `Authorization: Bearer <token>`). Commonly used in scripts and server-side code.
- **Per-User URL**: `https://YOUR-PRIVIDUM-ENDPOINT/rpc/wallet/{token}`: This is a user-specific URL that embeds a
  persistent authentication token in the path. It requires per-transaction authorization (allowances) for write
  operations. Commonly used in browser-based wallets (e.g., MetaMask) which cannot attach custom headers.

> [!NOTE] NOTE
>
> Per-User RPC Details For comprehensive details on the per-user RPC URL architecture, transaction allowances, and
> wallet RPC behavior, see [Per-User RPC Documentation](../30.per-user-rpc.md).

## Browser Extension Wallets

Browser extension wallets (like Metamask) require a custom RPC endpoint configuration to work with Prividium.

### Why Custom RPC Endpoint is Required

Browser extension wallets **do not support authentication headers**. They cannot use the default `/rpc` endpoint
directly. Instead, use the per-user `/wallet/{token}` RPC endpoint, which embeds the authentication token in the URL
path.

> [!NOTE] Per-User RPC Details
>
> For comprehensive details on the per-user RPC URL architecture, token lifecycle, transaction allowances, and wallet
> RPC behavior, see [Per-User RPC Documentation](../30.per-user-rpc.md).

### Authentication RPC Endpoint

When users authenticate with wallet scopes (`wallet:required` and `network:required`), Prividium™ generates a
user-specific wallet token and provides a custom RPC endpoint (`/rpc/wallet/{token}`). This endpoint:

- **Embeds authentication in the URL** - No auth headers needed
- **Is user-specific** - The token remains constant for the user until rotated
- **Enforces transaction allowances** - Each write operation requires an active allowance provided via the API

### Configuration Flow

1. **User authenticates** with wallet scopes - This triggers the generation of a wallet token via the Prividium™ API
2. **Obtain the RPC URL** - Use `prividium.getWalletRpcUrl()` to retrieve the user's custom RPC endpoint
   (`/rpc/wallet/{token}`)
3. **Configure wallet network** - Use `prividium.addNetworkToWallet()` or manually configure the wallet with this RPC
   URL
4. **User connects wallet** - The user must still explicitly connect their browser wallet to your application
   (authentication alone does not automatically connect the wallet)

### Example Integration

```typescript
import { prividium } from './prividium-config';

// After user authenticates with wallet scopes
if (prividium.isAuthorized()) {
  // Get the user's custom RPC endpoint
  const walletRpcUrl = await prividium.getWalletRpcUrl();
  // Returns: https://api.prividium.dev/rpc/wallet/{user-token}

  // Configure wallet network with this RPC URL
  await prividium.addNetworkToWallet();
  // This prompts the user to add the network to their wallet

  // User still needs to connect the wallet
  // This is a separate step from authentication
}
```

> [!IMPORTANT] IMPORTANT
>
> Authentication provides the configuration, but users must still connect their wallet. Authentication and wallet
> connection are separate steps.

### Reading from Contracts

Use `prividium.transport` to create an authenticated RPC client for read operations:

```typescript
import { getContract, createPublicClient } from 'viem';
import { prividiumChain, prividium } from './prividium-config';

// Get wallet address
const accounts = await walletClient.getAddresses();
const address = accounts[0];

// Create authenticated RPC client
const rpcClient = createPublicClient({
  chain: prividiumChain,
  transport: prividium.transport,
  account: address // required for read from contract operations
});

// Read contract function
const contract = getContract({
  address: CONTRACT_ADDRESS,
  abi: CONTRACT_ABI,
  client: rpcClient
});

const value = await contract.read.getValue();
```

### Sending Transactions

**⚠️ Critical Requirements**

When sending transactions, you **MUST**:

1. Pre-fetch nonce, gas estimate, and gas price using the authenticated RPC client (`prividium.transport`)
2. Authorize transaction via `prividium.authorizeTransaction()`
3. Pass pre-fetched values to `walletClient.sendTransaction()`

**Why pre-fetching is required:** Wallets lack authentication headers. Pre-fetch transaction parameters using the
authenticated client so the wallet only signs and broadcasts.

### Complete Transaction Pattern

```typescript
import { encodeFunctionData, createWalletClient, createPublicClient, custom } from 'viem';
import { createPrividiumClient } from 'prividium';
import { prividium } from './prividium-config';

const rpcClient = createPrividiumClient({
  chain: prividium.chain,
  transport: prividium.transport
});

const walletClient = createWalletClient({
  account: address,
  chain: prividium.chain,
  transport: custom(window.ethereum)
});

async function sendTransaction(contractAddress: Address, functionName: string, args: any[], value: bigint = 0n) {
  // Encode function data
  const data = encodeFunctionData({
    abi: CONTRACT_ABI,
    functionName,
    args
  });

  // Pre-fetch transaction parameters using authenticated client
  const nonce = await rpcClient.getTransactionCount({ address });
  const gas = await rpcClient.estimateGas({
    account: address,
    to: contractAddress,
    data
  });
  const gasPrice = await rpcClient.getGasPrice();

  // Authorize transaction (REQUIRED before each transaction)
  await prividium.authorizeTransaction({
    walletAddress: address,
    contractAddress,
    nonce,
    calldata: data,
    value: value
  });

  // Send transaction with pre-fetched values
  const hash = await walletClient.sendTransaction({
    account: address,
    to: contractAddress,
    data,
    nonce,
    gas,
    gasPrice
  });

  return hash;
}
```

### Transaction Allowance

> [!IMPORTANT] IMPORTANT
>
> Call `prividium.authorizeTransaction()` before **every transaction**. Permission is transaction-specific and expires
> after 1 hour.

For detailed information about transaction allowances, their lifecycle, and how they work with the per-user RPC
endpoint, see [Per-User RPC Documentation](../30.per-user-rpc.md#transaction-allowances).

```typescript
await prividium.authorizeTransaction({
  walletAddress: address,
  contractAddress,
  nonce,
  calldata: encodedFunctionData,
  value: transactionValue ?? 0n
});
```

## Error Handling

### Common Errors and Solutions

#### 401 Unauthorized on Read Operations

**Cause:** Not using authenticated transport

**Solution:**

```typescript
// ❌ Wrong - uses MetaMask RPC (no auth headers)
const client = createPublicClient({
  chain: prividium.chain,
  transport: custom(window.ethereum),
  account: address
});

// ✅ Correct - uses authenticated transport
const client = createPublicClient({
  chain: prividium.chain,
  transport: prividium.transport, // Includes auth headers
  account: address
});
```

#### Error "RPC method eth_call requires an account to be provided for the client"

**Cause:** Missing `account` in RPC client for read operations

**Solution:**

```typescript
// ❌ Wrong - uses MetaMask RPC (no auth headers)
const client = createPublicClient({
  chain: prividium.chain,
  transport: custom(window.ethereum),
  account: undefined
});

const contract = getContract({
  address: CONTRACT_ADDRESS,
  abi: CONTRACT_ABI,
  client: rpcClient
});

contract.read.getGreeting(); // Fails with error

// ✅ Always provide account before read operations
const client = createPublicClient({
  chain: prividium.chain,
  transport: prividium.transport,
  account: address // Required for reading from contracts
});

const contract = getContract({
  address: CONTRACT_ADDRESS,
  abi: CONTRACT_ABI,
  client: rpcClient
});

contract.read.getGreeting(); // Succeeds
```

#### 401 Unauthorized on Write Operations

**Cause:** Missing transaction allowance or not pre-fetching parameters

**Solution:**

```typescript
// ✅ Always enable wallet token before sending
await prividium.authorizeTransaction({
  walletAddress: address,
  contractAddress,
  nonce,
  calldata: data,
})

// ✅ Always pre-fetch using authenticated client
const nonce = await rpcClient.getTransactionCount({ address })
const gas = await rpcClient.estimateGas({ ... })
const gasPrice = await rpcClient.getGasPrice()
```

#### "Wallet is on wrong network"

**Cause:** MetaMask not configured with `/wallet/{token}` RPC URL

**Solution:**

```typescript
// Ensure network is configured before transactions
await ensureWalletReady(); // Calls addNetworkToWallet() if needed
```

## Summary

Key takeaways for building on Prividium:

1. **Authentication**: Use SDK's popup-based OAuth flow with appropriate scopes
2. **Reads**: Always use `prividium.transport` (authenticated `/rpc` endpoint)
3. **Writes**: Pre-fetch nonce, gas, gas price using authenticated client, authorize wallet transaction, then send via
   browser extension wallet
4. **Network**: Configure browser extension wallet with `/wallet/{token}` RPC URL via `addNetworkToWallet()`
5. **Environment**: Use base Prividium™ api URL in your RPC URL environment variable, SDK constructs wallet URLs
   automatically
6. **Errors**: Handle 401 errors by ensuring authenticated clients and transaction allowances

These patterns ensure secure, reliable interactions with Prividium™ chains.

## Next Steps

- [Contract Deployment and Scripting](10.contract-deployment-scripting.md)
- [AI Agent Guide for Prividium™](30.ai-context.md) - Guidelines for AI agents working with Prividium™
